msys2 third atempt, using msys2 shell

#  download and extract latest gdal from metacpan


export ST_PERL=/c/berrybrew/5.24.0_64_PDL
export GDAL_ROOT=/c/gdal_builds/gdal-2.1.2
export PATH=${ST_PERL}/c/bin:${ST_PERL}/perl/site/bin:${ST_PERL}/perl/bin:${PATH}
#  for -L
export LIBRARY_PATH=${ST_PERL}/perl/lib/CORE:${ST_PERL}/c/lib:${GDAL_ROOT}
#  for -I  (might need to edit gdal-config of Makefile.pl?)
export CPATH=${ST_PERL}/c/include:${ST_PERL}/perl/lib/CORE

# edit Makefile.PL to generate a make-style makefile
# WriteMakefile (
#     MAKE => 'make',
# ...
# );

perl Makefile.PL --gdal-config=${GDAL_ROOT}/apps/gdal-config --no-version-check


#  we get this:
# $ perl Makefile.PL --gdal-config=${GDAL_ROOT}/apps/gdal-config --no-version-check
  # -lodbc32 -lodbccp32 -L/../../lib -lnetcdf -lhdf5 -lgif -ljpeg -ltiff -lpng -lcfitsio -LC:/BERRYB~1/524~1.0_6/c/lib -lpq -lz -lpthread  -lws2_32   -L/mingw64/lib -lcurl -lnghttp2 -lidn -lrtmp -lssh2 -lssl -lcrypto -lssl -lcrypto -lgdi32 -lwldap32 -lz -lws2_32             -L/../../lib -lxml2 -lz -lws2_32
# -I/c/gdal_builds/gdal-2.1.2/port -I/c/gdal_builds/gdal-2.1.2/gcore -I/c/gdal_builds/gdal-2.1.2/alg -I/c/gdal_builds/gdal-2.1.2/ogr -I/c/gdal_builds/gdal-2.1.2/ogr/ogrsf_frmts -I/c/gdal_builds/gdal-2.1.2/frmts/vrt -I/c/gdal_builds/gdal-2.1.2/apps
# Warning (mostly harmless): No library found for -lcurl
# Warning (mostly harmless): No library found for -lnghttp2
# Warning (mostly harmless): No library found for -lidn
# Warning (mostly harmless): No library found for -lrtmp
# Warning (mostly harmless): No library found for -lssl
# Warning (mostly harmless): No library found for -lcrypto
# Warning (mostly harmless): No library found for -lssl
# Warning (mostly harmless): No library found for -lcrypto
# Generating a make-style Makefile_Geo__GDAL
# Writing Makefile_Geo__GDAL for Geo::GDAL
# Writing MYMETA.yml and MYMETA.json
# WARNING: Setting ABSTRACT via file 'lib/Geo/GDAL.pm' failed
 # at C:/berrybrew/5.24.0_64_PDL/perl/lib/ExtUtils/MakeMaker.pm line 755.
# Warning (mostly harmless): No library found for -lcurl
# Warning (mostly harmless): No library found for -lnghttp2
# Warning (mostly harmless): No library found for -lidn
# Warning (mostly harmless): No library found for -lrtmp
# Warning (mostly harmless): No library found for -lssl
# Warning (mostly harmless): No library found for -lcrypto
# Warning (mostly harmless): No library found for -lssl
# Warning (mostly harmless): No library found for -lcrypto
# Generating a make-style Makefile_Geo__GDAL__Const
# Writing Makefile_Geo__GDAL__Const for Geo::GDAL::Const
# Writing MYMETA.yml and MYMETA.json
# WARNING: Setting ABSTRACT via file 'lib/Geo/GDAL.pm' failed
 # at C:/berrybrew/5.24.0_64_PDL/perl/lib/ExtUtils/MakeMaker.pm line 755.
# Warning (mostly harmless): No library found for -lcurl
# Warning (mostly harmless): No library found for -lnghttp2
# Warning (mostly harmless): No library found for -lidn
# Warning (mostly harmless): No library found for -lrtmp
# Warning (mostly harmless): No library found for -lssl
# Warning (mostly harmless): No library found for -lcrypto
# Warning (mostly harmless): No library found for -lssl
# Warning (mostly harmless): No library found for -lcrypto
# Generating a make-style Makefile_Geo__OGR
# Writing Makefile_Geo__OGR for Geo::OGR
# Writing MYMETA.yml and MYMETA.json
# WARNING: Setting ABSTRACT via file 'lib/Geo/GDAL.pm' failed
 # at C:/berrybrew/5.24.0_64_PDL/perl/lib/ExtUtils/MakeMaker.pm line 755.
# Warning (mostly harmless): No library found for -lcurl
# Warning (mostly harmless): No library found for -lnghttp2
# Warning (mostly harmless): No library found for -lidn
# Warning (mostly harmless): No library found for -lrtmp
# Warning (mostly harmless): No library found for -lssl
# Warning (mostly harmless): No library found for -lcrypto
# Warning (mostly harmless): No library found for -lssl
# Warning (mostly harmless): No library found for -lcrypto
# Generating a make-style Makefile_Geo__OSR
# Writing Makefile_Geo__OSR for Geo::OSR
# Writing MYMETA.yml and MYMETA.json




##  adapted from Knittel notes
# Make the following changes:

sed -i -e 's/RANLIB = rem/RANLIB = ranlib/' Makefile_*
sed -i -e 's/NOOP = rem/NOOP =/' Makefile_*
sed -i -e 's/DIRFILESEP = \\/DIRFILESEP = \//' Makefile_*
#  iostream issues - just comment it out
sed -i -e 's/#include <iostream>/\/\/#include <iostream>/' *wrap.cpp
#  next line should not be needed
sed -i -e 's/\/mingw\/bin\/x86_64-w64-mingw32-g++/g++/' Makefile_*
# The paths were written in format: /c/strawberry\perl\bin\perl.exe etc, which turns into C:strawberryperlbinperl.exe.  The following should transform '\' into '/', excluding cases such as \" and \(end of line):
sed -i -e 's/\\\([^\"\\]\)/\/\1/g' Makefile_*
#  and change "C:/berrybrew
sed -i -e 's/C\:\/berrybrew/\/c\/berrybrew/g' Makefile_*


#  now try making it
make

# #  We get an error like this:
# In file included from gdal_wrap.cpp:745:0:
# gdal_wrap.cpp: In function 'void VSIStdoutUnsetRedirection()':
# C:/berrybrew/5.24.0_64_PDL/perl/lib/CORE/XSUB.h:592:21: error: 'PerlSIO_fwrite' was not declared in this scope
# #    define fwrite  PerlSIO_fwrite
#                     ^
# gdal_wrap.cpp:2161:30: note: in expansion of macro 'fwrite'
#      VSIStdoutSetRedirection( fwrite, stdout );
#                               ^


# For now just edit that sub to do nothing - total kludge.
# Presumably we are getting the wrong fwrite?


# Then the tests all bomb out.  Make sure gdal.dll is in the path (copy it to the blib/bin folder)

# Then also manually copy the arch/auto contents into lib/auto/ (not sure that is a good idea either)

# Tests fail - badly in some cases.  Some will be due to the fwrite kludge, presumably.























msys2 second attempt

inside the msys shell

export ST=c:/berrybrew/5.24.0_64_PDL
export ST=C:/berrybrew/5.22.2_64
export ST=/c/berrybrew/5.22.2_64
export ST=/c/berrybrew/5.24.0_64_PDL
export PATH=${ST_PERL}/c/bin:${ST_PERL}/perl/site/bin:${ST_PERL}/perl/bin:${PATH}
#export LD_LIBRARY_PATH=/c/berrybrew/5.24.0_64_PDL/c/lib
export LIBRARY_PATH=/c/berrybrew/5.24.0_64_PDL/c/lib
export CPATH=/c/berrybrew/5.24.0_64_PDL/c/include

https://trac.osgeo.org/gdal/wiki/BuildingWithMinGW

poss have issue with path length - use a short one e.g. c:/gdal211

from https://trac.osgeo.org/gdal/wiki/FAQInstallationAndBuilding#CanIbuildGDALwithCygwinorMinGW
and http://www.gaia-gis.it/gaia-sins/mingw64_how_to.html#env
export "CPPLAGS=-I/usr/local/include"
export "LDFLAGS=-L/usr/local/lib"
#./configure --host=x86_64-w64-mingw32 \
#	--without-libtool --without-python --with-liblzma=yes
./configure \
	--without-libtool --without-python --with-liblzma=yes
	
	
need to update port/cpl_config.h
#define SIZEOF_UNSIGNED_LONG 4
#define SIZEOF_VOIDP 8

edit GNUmakefile so '$(GDAL_ROOT)' is '.'
This is needed as some argument lists get too long

Have not tried UTF8 filenames option from https://trac.osgeo.org/gdal/wiki/BuildingWithMinGW

use the strip utility to reduce the binary size.  https://trac.osgeo.org/geoinformatica/wiki/BuildWithMingw


#  wasted effort when trying mingw for everything
perl makefiles
DIRSEPSTR = /
DIRFILESEP = /



msys2 attempt

inside the msys shell

https://trac.osgeo.org/gdal/wiki/BuildingWithMinGW

need to update cpl_config.h
#define SIZEOF_UNSIGNED_LONG 4
maybe should be 8?


back in CMD land:
edit the gdal-config file to use c:/ instead of /c/
edit the perl Makefile.PL so we use `sh` when it calls $config.

comment out iostream as per Anthony's notes 




osgeo attempt
edit gdal-config in the os4 bin folder
rename gdal201.dll to libgdal.dll  #  needed?

rename gdal_i.lib -> gdal.lib  (makes it find -lgdal)

in Geo::GDAL folder:

\strawberry\set_strawberry_path.bat
set PATH=c:\shawn\bin\bash;c:\OSGeo4W64\bin;%PATH%

perl Makefile.PL --gdal-config=C:\OSGeo4W64\bin\gdal-config
